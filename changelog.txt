=== بازارا ===  
Author: گروه نرم‌افزاری محک  
Contributors: Erfan Nazari  
Author URI: https://www.mahaksoft.com/  
Plugin URI: https://www.mahaksoft.com/bazara/  

## [3.1044]

### Added
- پرش از روی محصولاتی که مقدار ویژگی‌ آن ها NULL است!
- نمایش علت سینک نشدن یک کالا در زمان سینک دستی

### Changed
- تغییر اسم تابع get_product_attributes() به get_product_attributes_plugin() به جهت رفع تداخل تکراری بودن نام تابع بین بازارا و قالب تکنو شاپ

### Fixed
- رفع خطا های مربوط به Cannot declare تقویم جلالی

## [3.1043]

## Added
- پرش از محصولات دارای مشکل بهینه شد  

---

## [3.1042] - 2025-09-27

### Added
- افزودن وضعیت جدید pws-shipping برای ارسال خودکار سفارشات با این وضعیت به بازارا.

- افزودن شرط تطبیق اقلام سفارش با داده‌های ارسالی به بازارا در محک.

- امکان ارسال مجدد فاکتور با کلیک روی دکمه «ارسال فاکتور بازارا» در بخش سفارشات، حتی در صورتی که قبلاً ارسال موفق (تیک سبز) ثبت شده باشد.

- افزودن لاگ‌ها و دامپ‌ها برای دیباگ سریع‌تر مشکلات احتمالی در فرآیند انتقال سفارش‌ها به بازارا در محک.

- افزودن min و max برای همگام‌سازی اطلاعات اشخاص در جدول wp_bazara_person.

- امکان همگام‌سازی دستی تصاویر کالاهایی که از محک سینک شده‌اند و در محک برای آنها تصویر اختصاص داده شده است.

- تکمیل اطلاعات جدول bazara_Region.

- پر شدن مقدار cityID در زمان ارسال سفارش از وب‌سایت.


### Changed
- بهینه‌سازی و بازنویسی تابع register_users.

- بهینه‌سازی و بازنویسی تابع save_update_person.

- جداسازی فرآیند سینک اشخاص از کران‌جاب run_product و تعریف کران‌جاب اختصاصی تحت عنوان bazara_run_persons_sync برای سینک اطلاعات اشخاص.

### Fixed
- رفع خطای مربوط به تقویم جلالی (function_exist jalali).

- رفع خطای bazara_convert_request_to_options.

- رفع خطای publishStatus.

- در فرآیند سینک کالاها: در صورتی که یک محصول به دلیل تعریف نادرست (مثلاً متغیر فرعی در کالای متغیر) خطا داشته باشد، از آن عبور می‌شود تا مانع سینک بقیه محصولات بدون مشکل نشود.

- رفع هشدارها (warnings) در تب سفارشات بخش تنظیمات همگام‌سازی و سایر خطاها و هشدارهای جزئی گزارش‌شده در error_log مشتریان.

- رفع مشکل سینک مجدد تمامی اشخاص در هر بار اجرای کران‌جاب run_product (اکنون فقط تغییرات و اشخاص جدید به‌صورت موردی سینک می‌شوند، که از فشار اضافی روی هاست جلوگیری می‌کند).

- رفع مشکل عدم پر شدن استان، کشور و نام شهر از سفارشات ووکامرس هنگام انتقال به حسابداری توسط پلاگین.

### Deprecated
- حذف هوک woo-thankyou برای ارسال خودکار سفارش در لحظه ثبت و جایگزینی آن با هوک woo-new-order.

### Security

_هیچ تغییر امنیتی ثبت نشده است_

## [3.1041] - 2025-06-28

### Fixed
- رفع مشکل پر نشدن جدول bazara_product_details به شکل صحیح

### Changed
- bazaraOptionsNeedSupportAccess تغییر کرد
- checkShouldLogin بهینه شد

## [3.1040] - 2025-05-10

### Added
- امکان شخصی‌سازی عدم ارسال سفارت در وضعیت‌های خاص مانند "در انتظار بررسی" و "کارت به کارت"
- همگام‌سازی با افزونه "کارت به کارت فراز"
- فعالسازی بازارا مشروط به فعال بودن ووکامرس شد
- اضافه کردن پیام‌های موفقیت‌آمیز بعد از سینک محصولات در لیست محصولات
- ارسال توضیحات سفارش به نرم افزار حسابداری محک
- اضافه کردن کتابخانه morilog/jalali بدون composer
- امکان سینک سینک موردی کالا های انتخاب شده از لیست محصولات و صرفا سینک همان کالا های مورد نظر

### Changed
- تغییر نحوه گرفتن دیتای محصولات از سرور و جابه جایی ترتیب پرکردن جداول برای رفع مشکلات بازارا مازاد
- بهینه سازی و ریفکتور تابع sync_picture()
- اصلاح  عملکرد تابع get_products() برای عملکرد بهتر و اعمال limit روی سینک محصولات (درصورت نیاز)
- استفاده از تابع normalize_datetime_to_gregorian() برای تنظیم کردن $complete_date
- بهینه سازی تابع register_users()
- حذف نیاز به پسورد پشتیبان برای تغییر تنظیمات قیمت‌گذاری
- بهینه‌سازی فرآیند ذخیره تنظیمات قیمت‌گذاری
- اصلاح نمایش مودال پسورد پشتیبان برای تغییرات غیر مرتبط با قیمت
- بهینه سازی تابع sync_picture() به منظور عملکرد بهتر و سازگار تر با تغییرات تصاویر در نرم افزار حسابداری
- استفاده از توابع ووکامرس برای مدیریت سینک تصاویر (مثال: حذف متا های مربوط به تصویر شاخص و گالری) به جای استفاده از توابعی که مستقیما روی دیتای موجود در دیتابیس اعمال میشوند

### Fixed
- رفع مشکل خواندن رکوردهای دارای `Deleted = 1` در جدول `wp_bazara_product_details`
- رفع باگ مدیریت موجودی در سطح کالای والد برای محصولات متغییر و مدیریت موجودی در سطح متغییر برای حل مشکل فروش کالا بدون موجودی و رفع مغایرت های مربوط به موجودی کالا های متغییر
- رفع مشکل عدم ارسال توضیحات فاکتور و سازگاری بیشتر کد با ووکامرس برای استخراج توضیحات از دیتابیس
- رفع مشکل سینک کلیه کالا های سینک نشده همراه با انتخاب کالا به صورت موردی از لیست محصولات
- رفع مشکل درخواست پسورد پشتیبان برای تغییر تنظیمات قیمت‌گذاری
- اصلاح شرط نمایش مودال پسورد پشتیبان در تابع check_login_sync
- حل مشکل مدیریت نادرست تصاویر با Deleted = 1 در جدول bazara_picture و بهینه سازی دیتای تصاویر آماده برای سینک

## [3.1039] - 2025-04-23

### Added
_هیچ موردی اضافه نشده است_

### Changed
- حذف تب "درباره افزونه"
- جابه‌جایی دکمه ذخیره تغییرات
- داینامیک‌سازی فیلد کد سفارش در تنظیمات > سفارشات (به‌روزرسانی خودکار با ثبت هر سفارش جدید)
- تغییر نام فیلدهای `MHk-0` و `MHK-Rate-0 x%` به "عوارض و مالیات محک x%" و "عوارض و مالیات"
- مرتب‌سازی صعودی خروجی توابع `get_orders()` و `get_orders_hpos()`
- به‌روزرسانی تابع `bazara_convert_request_to_options()` برای پر کردن داینامیک فیلد `order_id_greater_than`
- به‌روزرسانی تابع `start_sync_orders()` برای داینامیک‌سازی فیلد کد سفارش

### Fixed
- سازگاری کامل با HPOS
- رفع خطای مربوط به `address2`
- اصلاح تعریف نادرست jQuery
- اصلاح تعریف نادرست style (فایل Select2css)
- رفع خطای فایل `index` در دایرکتوری admin
- حذف `var_dump()`‌های بلااستفاده
- رفع عدم عملکرد اکشن‌ها در محصولات دارای مغایرت و امکان استناد به داده‌ها در لیست مغایرت‌ها
- رفع مشکل سینک محصول تکی در لیست محصولات + امکان جستجوی کد کالا و سینک تکی
- رفع خطای تیک ویژگی‌ها
- رفع خطای عدم تعریف متغیر `entities`
- رفع خطای ورودی اضافی به تابع `get_products()` در `start_sync_new_product()`
- رفع خطای عدم تعریف متغیر `active_sync` در فایل `class.bazara.api.php`
- اصلاح تعریف key/value‌ها در بخش `attributes`
- رفع خطای شخصی‌سازی dynamic-price (اصلاح تعریف استاتیک فانکشن)
- رفع Fatal error در صفحه تشکر از سفارش

### Deprecated
_هیچ موردی منسوخ نشده است_

### Security
_هیچ تغییر امنیتی ثبت نشده است_
